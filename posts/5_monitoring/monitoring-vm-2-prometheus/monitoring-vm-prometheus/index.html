<!doctype html><html><head><title>Easy Ways to Monitor Ubuntu VMs Using Node Exporter, Prometheus and Grafana - Part II</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/layouts/main.css><link rel=stylesheet href=/css/navigators/navbar.css><link rel=stylesheet href=/css/plyr.css><link rel=stylesheet href=/css/flag-icon.min.css><link rel=stylesheet href=/css/katex.min.css><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css><link rel=icon type=image/png href=/images/site/BYAMRIcom-favicon_hu3317f8b1d44c2135ae236f455e1a3d15_58339_42x0_resize_box_2.png><meta property="og:title" content="Easy Ways to Monitor Ubuntu VMs Using Node Exporter, Prometheus and Grafana - Part II"><meta property="og:description" content="Easy Ways to Monitor Ubuntu VMs Using Node Exporter, Prometheus and Grafana"><meta property="og:type" content="article"><meta property="og:url" content="https://me.byamri.com/posts/5_monitoring/monitoring-vm-2-prometheus/monitoring-vm-prometheus/"><meta property="article:published_time" content="2022-02-18T08:06:25+06:00"><meta property="article:modified_time" content="2022-02-18T08:06:25+06:00"><meta name=description content="Easy Ways to Monitor Ubuntu VMs Using Node Exporter, Prometheus and Grafana"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css><link rel=stylesheet href=/css/layouts/single.css><link rel=stylesheet href=/css/navigators/sidebar.css><link rel=stylesheet href=/css/style.css></head><body data-spy=scroll data-target=#TableOfContents data-offset=80><div class="container-fluid bg-dimmed wrapper"><nav class="navbar navbar-expand-xl top-navbar final-navbar shadow"><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button onclick=toggleSidebar()>
<span class=navbar-toggler-icon></span></button>
<a class=navbar-brand href=/><img src=/images/site/BYAMRIcom-logo_hub0cdfd126a2885dbd6bce6d48a0e1f6f_65018_42x0_resize_box_2.png alt=Logo>
My Resume</a>
<button class="navbar-toggler navbar-light" id=toc-toggler type=button onclick=toggleTOC()>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse lang-selector" id=top-nav-items><ul class="navbar-nav ml-auto"><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=languageSelector role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><span class="flag-icon flag-icon-gb"></span>English</a><div class=dropdown-menu aria-labelledby=languageSelector><a class="dropdown-item nav-link languages-item" href=/id/posts/5_monitoring/monitoring-vm-2-prometheus/monitoring-vm-prometheus><span class="flag-icon flag-icon-id"></span>Indonesian</a></div></li></ul></div></div><img src=/images/site/BYAMRIcom-logo_hub0cdfd126a2885dbd6bce6d48a0e1f6f_65018_42x0_resize_box_2.png class=d-none id=main-logo alt=Logo>
<img src=/images/site/BYAMRIcom-logo2_hu2284165ffeb77454cba45acef23638fe_75909_42x0_resize_box_2.png class=d-none id=inverted-logo alt="Inverted Logo"></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=/search><input type=text name=keyword placeholder=Search data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/posts data-filter=all>Posts</a></li><div class=subtree><li><a href=/posts/1_introduction/ title=Introduction>Introduction</a></li><li><i class="fas fa-plus-circle"></i><a href=/posts/2_openstack/>Openstack</a><ul><li><a href=/posts/2_openstack/artikel-1/artikel-1/ title="Openstack Introduction">Openstack Introduction</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/3_kubernetes/>Kubernetes</a><ul><li><a href=/posts/3_kubernetes/cara-konfigurasi-ha/cara-konfigurasi-ha/ title="Install Kubernetes HA">Install Kubernetes HA</a></li><li><a href=/posts/3_kubernetes/artikel-2/artikel-2/ title="Clustering Kubernetes using Kubeadm">Clustering Kubernetes using Kubeadm</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/4_docker/>Docker</a><ul><li><a href=/posts/4_docker/artikel-1/artikel-1/ title="Docker Introduction">Docker Introduction</a></li></ul></li><li><i class="fas fa-minus-circle"></i><a class=active href=/posts/5_monitoring/>Monitoring</a><ul class=active><li><a href=/posts/5_monitoring/monitoring-vm-1-node-exporter/monitoring-vm-1-node-exporter/ title="Part I - Monitoring VM on Prometheus and Grafana">Part I - Monitoring VM on Prometheus and Grafana</a></li><li><a class=active href=/posts/5_monitoring/monitoring-vm-2-prometheus/monitoring-vm-prometheus/ title="Part II - Monitoring VM on Prometheus and Grafana">Part II - Monitoring VM on Prometheus and Grafana</a></li></ul></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(https://me.byamri.com/images/default-hero.jpg)></div><div class=page-content><div class="author-profile ml-auto align-self-lg-center"><img class=rounded-circle src=/images/author/me2_hu6449058ebe31352b620a6ee237336747_560239_120x120_fit_box_2.png alt="Author Image"><h5 class=author-name>Roby Yasir Amri</h5><p>:date_full</p></div><div class=title><h1>Easy Ways to Monitor Ubuntu VMs Using Node Exporter, Prometheus and Grafana - Part II</h1></div><div class=taxonomy-terms><ul><li class=rounded><a href=/tags/kubernetes class="btn, btn-sm">Kubernetes</a></li><li class=rounded><a href=/tags/linux class="btn, btn-sm">Linux</a></li></ul></div><div class=post-content id=post-content><p>Hai Gaes!
Pada jurnal sebelumnya kita sudah bahas mengenai Cara Mudah Monitoring VM Ubuntu Menggunakan Node Exporter, Prometheus dan Grafana bagian satu yaitu install node exporter nih, sekarang kita lanjut buat install Prometheus dan Grafananya skuy!
Environtment dan resources masih sama seperti yang sebelumnya yah, kali ini kita lanjutin labnya.</p><img src=/posts/kubernetes/topologi-ha-kubernetes.png alt=Topologi width=600 height=700 class=center><p>Oke, karena kita masih menggunakan topologi yang sama kita bisa langsung lanjut aja ke cara Install Prometheus disalah satu VM/Instances. Ingat kita install Prometheus di VM rb-k8s-lb1 ya</p><h2 id=install-dan-konfigurasi>Install dan konfigurasi</h2><ol><li>Langkah pertama kita download file Prometheusnya dulu dengan command:</li></ol><pre><code>wget https://github.com/prometheus/prometheus/releases/download/v2.33.0/prometheus-2.33.0.linux-amd64.tar.gz
</code></pre><ol start=2><li>Kemudian kita ekstrak hasil download tadi:</li></ol><pre><code>tar xvfz prometheus-2.33.0.linux-amd64.tar.gz
</code></pre><ol start=3><li>Kita pindahkan hasil ekstrak ke directory /opt</li></ol><pre><code>mv prometheus-2.33.0.linux-amd64 /opt
</code></pre><ol start=4><li>Kemudian ubah isi file prometheus.yaml menjadi seperti ini:</li></ol><pre><code>sudo cp /opt/prometheus-2.33.0.linux-amd64/prometheus.yml /opt/prometheus-2.33.0.linux-amd64/prometheus.yml.bak
sudo nano /opt/prometheus-2.33.0.linux-amd64/prometheus.yml
</code></pre><pre><code># my global config
global:
  scrape_interval: 15s # Set the scrape interval to every 15 seconds. Default is every 1 minute.
  evaluation_interval: 15s # Evaluate rules every 15 seconds. The default is every 1 minute.
  # scrape_timeout is set to the global default (10s).

# Alertmanager configuration
alerting:
  alertmanagers:
    - static_configs:
        - targets:
          # - alertmanager:9093

# Load rules once and periodically evaluate them according to the global 'evaluation_interval'.
rule_files:
  # - &quot;first_rules.yml&quot;
  # - &quot;second_rules.yml&quot;

# A scrape configuration containing exactly one endpoint to scrape:
# Here it's Prometheus itself.
scrape_configs:
  # The job name is added as a label `job=job_name` to any timeseries scraped from this config.
  - job_name: 'loadbalancer'

    # metrics_path defaults to '/metrics'
    # scheme defaults to 'http'.

    static_configs:
    - targets: 
      - '10.60.60.43:9100'
      - '10.60.60.44:9100'

  - job_name: 'master'
    static_configs:
    - targets:
      - '10.60.60.51:9100'
      - '10.60.60.52:9100'
      - '10.60.60.53:9100'

  - job_name: 'worker'
    static_configs:
    - targets:
      - '10.60.60.54:9100'
      - '10.60.60.55:9100'
      - '10.60.60.56:9100'
</code></pre><ol start=5><li>Buat file dengan nama prometheus_server.service agar ketika server di reboot/restart service tetap berjalan</li></ol><pre><code>nano /etc/systemd/system/prometheus_server.service
</code></pre><pre><code>[Unit]
Description=Prometheus Server

[Service]
User=root
ExecStart=/opt/prometheus-2.33.0.linux-amd64/prometheus --config.file=/opt/prometheus-2.33.0.linux-amd64/prometheus.yml --web.external-url=http://10.60.60.43:9090/

[Install]
WantedBy=default.target
</code></pre><ol start=6><li>Kemudian Enable, start, Service tersebut dengan command:</li></ol><pre><code>systemctl enable prometheus_server.service
systemctl start prometheus_server.service\
</code></pre><h2 id=verifikasi>Verifikasi</h2><ol start=7><li>Pastikan service Prometheus berjalan</li></ol><pre><code>systemctl status prometheus_server.service
</code></pre><pre><code>root@rb-k8s-lb1:/opt/prometheus-2.33.0.linux-amd64# systemctl status prometheus_server.service
● prometheus_server.service - Prometheus Server
     Loaded: loaded (/etc/systemd/system/prometheus_server.service; enabled; vendor preset: enabled)
     Active: active (running) since Fri 2022-03-11 18:59:53 UTC; 2s ago
   Main PID: 1408527 (prometheus)
      Tasks: 10 (limit: 4676)
     Memory: 70.7M
     CGroup: /system.slice/prometheus_server.service
             └─1408527 /opt/prometheus-2.33.0.linux-amd64/prometheus --config.file=/opt/prometheus-2.33.0.linux-amd64/prometheus.yml --web.external-url=http://10.60.60.43:9090/

Mar 11 18:59:54 rb-k8s-lb1 prometheus[1408527]: ts=2022-03-11T18:59:54.952Z caller=head.go:604 level=info component=tsdb msg=&quot;WAL segment loaded&quot; segment=371 maxSegment=374
Mar 11 18:59:55 rb-k8s-lb1 prometheus[1408527]: ts=2022-03-11T18:59:55.148Z caller=head.go:604 level=info component=tsdb msg=&quot;WAL segment loaded&quot; segment=372 maxSegment=374
Mar 11 18:59:55 rb-k8s-lb1 prometheus[1408527]: ts=2022-03-11T18:59:55.340Z caller=head.go:604 level=info component=tsdb msg=&quot;WAL segment loaded&quot; segment=373 maxSegment=374
Mar 11 18:59:55 rb-k8s-lb1 prometheus[1408527]: ts=2022-03-11T18:59:55.341Z caller=head.go:604 level=info component=tsdb msg=&quot;WAL segment loaded&quot; segment=374 maxSegment=374
Mar 11 18:59:55 rb-k8s-lb1 prometheus[1408527]: ts=2022-03-11T18:59:55.341Z caller=head.go:610 level=info component=tsdb msg=&quot;WAL replay completed&quot; checkpoint_replay_duration=1.203064377s wal_replay_duration=534.227604ms total_replay_duration=1.776991108s
Mar 11 18:59:55 rb-k8s-lb1 prometheus[1408527]: ts=2022-03-11T18:59:55.346Z caller=main.go:944 level=info fs_type=EXT4_SUPER_MAGIC
Mar 11 18:59:55 rb-k8s-lb1 prometheus[1408527]: ts=2022-03-11T18:59:55.346Z caller=main.go:947 level=info msg=&quot;TSDB started&quot;
Mar 11 18:59:55 rb-k8s-lb1 prometheus[1408527]: ts=2022-03-11T18:59:55.346Z caller=main.go:1128 level=info msg=&quot;Loading configuration file&quot; filename=/opt/prometheus-2.33.0.linux-amd64/prometheus.yml
Mar 11 18:59:55 rb-k8s-lb1 prometheus[1408527]: ts=2022-03-11T18:59:55.357Z caller=main.go:1165 level=info msg=&quot;Completed loading of configuration file&quot; filename=/opt/prometheus-2.33.0.linux-amd64/prometheus.yml totalDuration=10.632798ms db_storage=1.542µs remote_stora&gt;
Mar 11 18:59:55 rb-k8s-lb1 prometheus[1408527]: ts=2022-03-11T18:59:55.357Z caller=main.go:896 level=info msg=&quot;Server is ready to receive web requests.&quot;
root@rb-k8s-lb1:/opt/prometheus-2.33.0.linux-amd64#
</code></pre><p>Untuk testing bisa gunakan browser atau dengan command curl melalui port 9090</p><pre><code>root@rb-k8s-lb1:/opt/prometheus-2.33.0.linux-amd64# curl 10.60.60.43:9090
</code></pre><img src=/posts/monitoring/prometheus-1.png alt=Topologi width=600 height=700 class=center>
<img src=/posts/monitoring/prometheus-2.png alt=Topologi width=600 height=700 class=center><p>Ok gaes, untuk kali ini sampai sini dulu, nanti kita lanjut untuk install Grafananya yah, terimakasih</p></div><div class="row pl-3 pr-3"><div class="col-md-6 share-buttons"><strong>Share on:</strong>
<a class="btn btn-sm facebook-btn" href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fme.byamri.com%2fposts%2f5_monitoring%2fmonitoring-vm-2-prometheus%2fmonitoring-vm-prometheus%2f" target=_blank><i class="fab fa-facebook"></i></a><a class="btn btn-sm twitter-btn" href="https://twitter.com/share?url=https%3a%2f%2fme.byamri.com%2fposts%2f5_monitoring%2fmonitoring-vm-2-prometheus%2fmonitoring-vm-prometheus%2f&text=Easy%20Ways%20to%20Monitor%20Ubuntu%20VMs%20Using%20Node%20Exporter%2c%20Prometheus%20and%20Grafana%20-%20Part%20II&via=My%20Resume" target=_blank><i class="fab fa-twitter"></i></a><a class="btn btn-sm reddit-btn" href="https://reddit.com/submit?url=https%3a%2f%2fme.byamri.com%2fposts%2f5_monitoring%2fmonitoring-vm-2-prometheus%2fmonitoring-vm-prometheus%2f&title=Easy%20Ways%20to%20Monitor%20Ubuntu%20VMs%20Using%20Node%20Exporter%2c%20Prometheus%20and%20Grafana%20-%20Part%20II" target=_blank><i class="fab fa-reddit"></i></a><a class="btn btn-sm linkedin-btn" href="https://www.linkedin.com/shareArticle?url=https%3a%2f%2fme.byamri.com%2fposts%2f5_monitoring%2fmonitoring-vm-2-prometheus%2fmonitoring-vm-prometheus%2f&title=Easy%20Ways%20to%20Monitor%20Ubuntu%20VMs%20Using%20Node%20Exporter%2c%20Prometheus%20and%20Grafana%20-%20Part%20II" target=_blank><i class="fab fa-linkedin"></i></a><a class="btn btn-sm whatsapp-btn" href="https://api.whatsapp.com/send?text=Easy%20Ways%20to%20Monitor%20Ubuntu%20VMs%20Using%20Node%20Exporter%2c%20Prometheus%20and%20Grafana%20-%20Part%20II https%3a%2f%2fme.byamri.com%2fposts%2f5_monitoring%2fmonitoring-vm-2-prometheus%2fmonitoring-vm-prometheus%2f" target=_blank><i class="fab fa-whatsapp"></i></a><a class="btn btn-sm email-btn" href="mailto:?subject=Easy%20Ways%20to%20Monitor%20Ubuntu%20VMs%20Using%20Node%20Exporter%2c%20Prometheus%20and%20Grafana%20-%20Part%20II&body=https%3a%2f%2fme.byamri.com%2fposts%2f5_monitoring%2fmonitoring-vm-2-prometheus%2fmonitoring-vm-prometheus%2f" target=_blank><i class="fas fa-envelope-open-text"></i></a></div><div class="col-md-6 btn-improve-page"><a href=https://github.com/RobyYasirAmri/robyyasiramri.github.io/edit/main/content/posts/5_monitoring/monitoring-vm-2-prometheus/monitoring-vm-prometheus.md title="Improve this page" target=_blank rel=noopener><i class="fas fa-code-branch"></i>Improve this page</a></div></div><hr><div class="row next-prev-navigator"><div class="col-md-6 previous-article"><a href=/posts/5_monitoring/monitoring-vm-1-node-exporter/monitoring-vm-1-node-exporter/ title="Easy Ways to Monitor Ubuntu VMs Using Node Exporter, Prometheus and Grafana" class="btn btn-outline-info"><div><i class="fas fa-chevron-circle-left"></i>Prev</div><div class=next-prev-text>Easy Ways to Monitor Ubuntu VMs Using Node Exporter, Prometheus and Grafana</div></a></div></div><hr></div></div></div><a id=scroll-to-top class=btn><i class="fas fa-chevron-circle-up"></i></a><div class="dropdown languageSelector"><a class="btn dropdown-toggle" href=# id=languageSelector role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><span class="flag-icon flag-icon-gb"></span>English</a><div class=dropdown-menu aria-labelledby=languageSelector><a class="dropdown-item nav-link languages-item" href=/id/posts/5_monitoring/monitoring-vm-2-prometheus/monitoring-vm-prometheus><span class="flag-icon flag-icon-id"></span>Indonesian</a></div></div></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center pl-3">Table of Contents</h5><hr><div class=toc><nav id=TableOfContents><ul><li><a href=#install-dan-konfigurasi>Install dan konfigurasi</a></li><li><a href=#verifikasi>Verifikasi</a></li></ul></nav></div></div></section></div><footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-left"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=https://me.byamri.com#about>About</a></li><li class=nav-item><a class=smooth-scroll href=https://me.byamri.com#skills>Skills</a></li><li class=nav-item><a class=smooth-scroll href=https://me.byamri.com#experiences>Experiences</a></li><li class=nav-item><a class=smooth-scroll href=https://me.byamri.com#education>Education</a></li><li class=nav-item><a class=smooth-scroll href=https://me.byamri.com#projects>Projects</a></li><li class=nav-item><a class=smooth-scroll href=https://me.byamri.com#recent-posts>Recent Posts</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contact me:</h5><ul><li><a href=mailto:roby@byamri.com target=_blank rel=noopener><span><i class="fas fa-envelope"></i></span><span>roby@byamri.com</span></a></li><li><span><i class="fas fa-phone-alt"></i></span><span>+6285155274275</span></li></ul></div><div class="col-md-4 col-sm-12"><p>Stay up to date with email notification</p><form action="https://github.us1.list-manage.com/subscribe/post?u=19de52a4603135aae97163fd8&amp;amp;id=094a24c76e" method=post id=mc-embedded-subscribe-form name=mc-embedded-subscribe-form class=validate target=_blank novalidate><div class=form-group><input type=email class=form-control id=mce-EMAIL name=EMAIL aria-describedby=emailHelp placeholder="Enter email">
<small id=emailHelp class="form-text text-muted">By entering your email address, you agree to receive the newsletter of this website.</small></div><button type=submit class="btn btn-info">Submit</button></form></div></div></div><hr><div class=container><p id=disclaimer><strong>Liability Notice:</strong> This theme is under MIT license. So, you can use it for non-commercial, commercial, or private uses. You can modify or distribute the theme without requiring any permission from the theme author. However, the theme author does not provide any warranty or takes any liability for any issue with the theme.</p></div><hr><div class=container><div class="row text-left"><div class=col-md-4><a id=theme href=https://github.com/hossainemruz/toha target=_blank rel=noopener><img src=/images/theme-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_32x0_resize_box_2.png alt="Toha Theme Logo">
Toha</a></div><div class="col-md-4 text-center">© 2022 Copyright.</div><div class="col-md-4 text-right"><a id=hugo href=https://gohugo.io/ target=_blank rel=noopener>Powered by
<img src=/images/hugo-logo.svg alt="Hugo Logo" height=18></a></div></div></div></footer><script type=text/javascript src=/js/jquery-3.4.1.min.js></script><script type=text/javascript src=/js/popper.min.js></script><script type=text/javascript src=/js/bootstrap.min.js></script><script type=text/javascript src=/js/navbar.js></script><script type=text/javascript src=/js/plyr.js></script><script type=text/javascript src=/js/main.js></script><script type=text/javascript defer src=/js/katex.min.js></script><script type=text/javascript defer src=/js/auto-render.min.js onload=renderMathInElement(document.body);></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js></script><script src=/js/single.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>